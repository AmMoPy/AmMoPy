const modal=document.getElementById("contact-modal");const contactLink=document.getElementById("contact-link");const closeBtn=document.querySelector(".close");const form=document.getElementById("contact-form");const statusDiv=document.createElement("div");function debugLog(message,data={}){console.log(`[Contact Form Debug] ${message}`,{timestamp:(new Date).toISOString(),page:window.location.href,...data})}statusDiv.id="form-status";statusDiv.style.marginTop="10px";statusDiv.style.padding="5px";statusDiv.style.borderRadius="3px";statusDiv.style.display="none";form.appendChild(statusDiv);function showStatus(message,isError=false){statusDiv.textContent=message;statusDiv.style.display="block";statusDiv.style.backgroundColor=isError?"#ffdddd":"#ddffdd";statusDiv.style.color=isError?"#990000":"#006600"}contactLink.addEventListener("click",(async e=>{e.preventDefault();debugLog("Contact link clicked, opening modal");modal.style.display="block";statusDiv.style.display="none";form.reset();debugLog("Fetching CSRF token from API");try{const response=await fetch("https://werdos.vercel.app/api/sendEmail",{method:"GET",credentials:"include"});if(!response.ok){throw new Error(`Failed to fetch CSRF token: ${response.status}`)}const data=await response.json();debugLog("CSRF token fetch successful",{status:response.status,data:data});const hasCookies=document.cookie.includes("csrfToken");debugLog("Cookie check after fetch",{cookiesExist:hasCookies,cookieString:document.cookie.length>0?"Present (contents hidden)":"Empty"})}catch(error){debugLog("CSRF Token Error",{error:error.message});showStatus("Error preparing the contact form. Please try again later.",true)}}));closeBtn.addEventListener("click",(()=>{debugLog("Modal closed via close button");modal.style.display="none"}));window.addEventListener("click",(e=>{if(e.target===modal){debugLog("Modal closed via outside click");modal.style.display="none"}}));const sanitizeInput=input=>input.replace(/</g,"&lt;").replace(/>/g,"&gt;");form.addEventListener("submit",(async e=>{e.preventDefault();debugLog("Form submission initiated");const email=sanitizeInput(document.getElementById("email").value);const subject=sanitizeInput(document.getElementById("subject").value);const message=sanitizeInput(document.getElementById("message").value);debugLog("Form data collected",{hasEmail:!!email,hasSubject:!!subject,messageLength:message.length});showStatus("Sending message...");try{debugLog("Sending POST request to API");const hasCookies=document.cookie.includes("csrfToken");debugLog("Cookie status before POST",{cookiesExist:hasCookies,cookieString:document.cookie.length>0?"Present (contents hidden)":"Empty"});const response=await fetch("https://werdos.vercel.app/api/sendEmail",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:email,subject:subject,message:message})});const responseData=await response.json();debugLog("API response received",{status:response.status,responseData:responseData,headers:Array.from(response.headers.entries())});if(response.ok){debugLog("Message sent successfully");showStatus("Message sent successfully!");setTimeout((()=>{modal.style.display="none"}),2e3)}else{throw new Error(responseData.error||"Failed to send message")}}catch(error){debugLog("Error during form submission",{errorMessage:error.message,errorStack:error.stack});showStatus(`Failed to send message: ${error.message}. Please try again.`,true)}}));